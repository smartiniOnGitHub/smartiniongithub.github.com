<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">test/cloudevent-serialization.test.js | cloudevent</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="JavaScript/Node.js implementation of the CloudEvents standard format"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="cloudevent"><meta property="twitter:description" content="JavaScript/Node.js implementation of the CloudEvents standard format"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/smartiniOnGitHub/cloudevent.js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cloudevent.js~CloudEvent.html">CloudEvent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validator.js~Validator.html">Validator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">test/cloudevent-serialization.test.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*
 * Copyright 2018 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
&apos;use strict&apos;

const assert = require(&apos;assert&apos;)
const test = require(&apos;tap&apos;).test

/** @test {CloudEvent} */
test(&apos;ensure decorator functions (exposed by the plugin) exists&apos;, (t) =&gt; {
  t.plan(6)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  // optional, using some standard Node.js assert statements, as a sample
  assert(CloudEvent !== null)
  assert.strictEqual(typeof CloudEvent, &apos;function&apos;)
  assert(new CloudEvent() instanceof CloudEvent)
  assert.strictEqual(CloudEvent.mediaType(), &apos;application/cloudevents+json&apos;)
  t.ok(CloudEvent)
  t.strictEqual(typeof CloudEvent, &apos;function&apos;)
  t.strictEqual(new CloudEvent() instanceof CloudEvent, true)
  t.strictEqual(CloudEvent.mediaType(), &apos;application/cloudevents+json&apos;)

  const ceSerialize = CloudEvent.serializeEvent
  assert(ceSerialize !== null)
  assert(typeof ceSerialize === &apos;function&apos;)
  t.ok(ceSerialize)
  t.strictEqual(typeof ceSerialize, &apos;function&apos;)
})

/** create some common options, for better reuse in tests */
const commonEventTime = new Date()
const ceCommonOptions = {
  eventTypeVersion: &apos;1.0.0&apos;,
  eventTime: commonEventTime,
  extensions: { &apos;exampleExtension&apos;: &apos;value&apos; },
  contentType: &apos;application/json&apos;,
  schemaURL: &apos;http://my-schema.localhost.localdomain&apos;,
  strict: false
}
/** create some common options with strict flag enabled, for better reuse in tests */
const ceCommonOptionsStrict = { ...ceCommonOptions, strict: true }
/** create some common data from an object, for better reuse in tests */
const ceCommonData = { &apos;hello&apos;: &apos;world&apos;, year: 2018 }
/** create some common data from a Map, for better reuse in tests */
const ceMapData = new Map() // empty Map
// const ceMapData = new Map([&apos;key-1&apos;, &apos;value 1&apos;], [&apos;key-2&apos;, &apos;value 2&apos;])
ceMapData.set(&apos;key-1&apos;, &apos;value 1&apos;)
ceMapData.set(&apos;key-2&apos;, &apos;value 2&apos;)

/** @test {CloudEvent} */
test(&apos;serialize some CloudEvent instances to JSON, and ensure they are right&apos;, (t) =&gt; {
  t.plan(36)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  // t.ok(CloudEvent)

  {
    // create an instance with undefined data attribute, but with strict flag disabled: expected success ...
    // note that null values are not handled by default values, only undefined values ...
    const ceFull = new CloudEvent(&apos;1/full/sample-data/no-strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      ceCommonOptions
    )
    assert(ceFull !== null)
    t.ok(ceFull)
    t.ok(ceFull.isValid())
    t.ok(ceFull.validate().length === 0)
    t.ok(ceFull.validate({ strict: false }).length === 0)
    t.ok(ceFull.validate({ strict: true }).length === 0)
    t.ok(CloudEvent.isValidEvent(ceFull))
    t.ok(CloudEvent.validateEvent(ceFull).length === 0)
    t.ok(CloudEvent.validateEvent(ceFull, { strict: false }).length === 0)
    t.ok(CloudEvent.validateEvent(ceFull, { strict: true }).length === 0)

    const ceFullSerializedStatic = CloudEvent.serializeEvent(ceFull)
    t.ok(ceFullSerializedStatic)
    const ceFullSerialized = ceFull.serialize()
    t.ok(ceFullSerialized)
    assert(ceFullSerializedStatic === ceFullSerialized)
    t.strictSame(ceFullSerializedStatic, ceFullSerialized)
    const ceSerialize = CloudEvent.serializeEvent
    assert(ceSerialize !== null)
    t.ok(ceSerialize)
    const ceFullSerializedFunction = ceSerialize(ceFull)
    t.ok(ceFullSerializedFunction)
    t.strictSame(ceFullSerializedFunction, ceFullSerializedStatic)
    t.strictSame(ceFullSerializedFunction, ceFullSerialized)

    const ceFullSerializedComparison = `{&quot;eventID&quot;:&quot;1/full/sample-data/no-strict&quot;,&quot;eventType&quot;:&quot;com.github.smartiniOnGitHub.cloudeventjs.testevent&quot;,&quot;source&quot;:&quot;/test&quot;,&quot;data&quot;:{&quot;hello&quot;:&quot;world&quot;,&quot;year&quot;:2018},&quot;cloudEventsVersion&quot;:&quot;0.1&quot;,&quot;contentType&quot;:&quot;application/json&quot;,&quot;eventTime&quot;:&quot;${commonEventTime.toISOString()}&quot;,&quot;eventTypeVersion&quot;:&quot;1.0.0&quot;,&quot;extensions&quot;:{&quot;exampleExtension&quot;:&quot;value&quot;},&quot;schemaURL&quot;:&quot;http://my-schema.localhost.localdomain&quot;}`
    t.strictSame(ceFullSerialized, ceFullSerializedComparison)
    const ceFullDeserialized = JSON.parse(ceFullSerialized) // note that some fields (like dates) will be different when deserialized in this way ...
    ceFullDeserialized.eventTime = commonEventTime // quick fix for the Date/timestamo attribute in the deserialized object
    t.same(ceFull, ceFullDeserialized)
  }

  {
    // the same with with strict mode enabled ...
    const ceFullStrict = new CloudEvent(&apos;1/full/sample-data/strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      ceCommonOptionsStrict
    )
    assert(ceFullStrict !== null)
    t.ok(ceFullStrict)
    t.ok(ceFullStrict.isValid())
    t.ok(ceFullStrict.validate().length === 0)
    t.ok(ceFullStrict.validate({ strict: true }).length === 0)
    t.ok(ceFullStrict.validate({ strict: false }).length === 0)
    t.ok(CloudEvent.isValidEvent(ceFullStrict))
    t.ok(CloudEvent.validateEvent(ceFullStrict).length === 0)
    t.ok(CloudEvent.validateEvent(ceFullStrict, { strict: true }).length === 0)
    t.ok(CloudEvent.validateEvent(ceFullStrict, { strict: false }).length === 0)

    const ceFullStrictSerializedStatic = CloudEvent.serializeEvent(ceFullStrict)
    t.ok(ceFullStrictSerializedStatic)
    const ceFullStrictSerialized = ceFullStrict.serialize()
    t.ok(ceFullStrictSerialized)
    assert(ceFullStrictSerializedStatic === ceFullStrictSerialized)
    t.strictSame(ceFullStrictSerializedStatic, ceFullStrictSerialized)
    const ceSerialize = CloudEvent.serializeEvent
    assert(ceSerialize !== null)
    t.ok(ceSerialize)
    const ceFullStrictSerializedFunction = ceSerialize(ceFullStrict)
    t.ok(ceFullStrictSerializedFunction)
    t.strictSame(ceFullStrictSerializedFunction, ceFullStrictSerializedStatic)
    t.strictSame(ceFullStrictSerializedFunction, ceFullStrictSerialized)

    const ceFullStrictSerializedComparison = `{&quot;eventID&quot;:&quot;1/full/sample-data/strict&quot;,&quot;eventType&quot;:&quot;com.github.smartiniOnGitHub.cloudeventjs.testevent&quot;,&quot;source&quot;:&quot;/test&quot;,&quot;data&quot;:{&quot;hello&quot;:&quot;world&quot;,&quot;year&quot;:2018},&quot;cloudEventsVersion&quot;:&quot;0.1&quot;,&quot;contentType&quot;:&quot;application/json&quot;,&quot;eventTime&quot;:&quot;${commonEventTime.toISOString()}&quot;,&quot;eventTypeVersion&quot;:&quot;1.0.0&quot;,&quot;extensions&quot;:{&quot;exampleExtension&quot;:&quot;value&quot;,&quot;strict&quot;:true},&quot;schemaURL&quot;:&quot;http://my-schema.localhost.localdomain&quot;}`
    t.strictSame(ceFullStrictSerialized, ceFullStrictSerializedComparison)
    const ceFullStrictDeserialized = JSON.parse(ceFullStrictSerialized) // note that some fields (like dates) will be different when deserialized in this way ...
    ceFullStrictDeserialized.eventTime = commonEventTime // quick fix for the Date/timestamo attribute in the deserialized object
    t.same(ceFullStrict, ceFullStrictDeserialized)
  }
})

/** @test {CloudEvent} */
test(&apos;serialize a CloudEvent instance with a non default contentType and empty serialization options, expect error&apos;, (t) =&gt; {
  t.plan(8)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  t.ok(CloudEvent)

  {
    // create an instance with non default contentType (other options default): expected success ...
    // when I try to serialize it without specifying already encoded data (encodedData options), expect to have an error raised ...
    const ceFullOtherContentType = new CloudEvent(&apos;1/non-default-contentType/sample-data/no-strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      {
        ...ceCommonOptions,
        contentType: &apos;application/xml&apos;
      }
    )
    assert(ceFullOtherContentType !== null)
    t.ok(ceFullOtherContentType)
    t.ok(ceFullOtherContentType.isValid())
    t.throws(function () {
      const ceFullOtherContentTypeSerialized = ceFullOtherContentType.serialize()
      assert(ceFullOtherContentTypeSerialized === null) // never executed
    }, Error, &apos;Expected exception when serializing the current CloudEvent instance&apos;)
  }

  {
    // the same with with strict mode enabled ...
    const ceFullOtherContentTypeStrict = new CloudEvent(&apos;1/non-default-contentType/sample-data/strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      {
        ...ceCommonOptionsStrict,
        contentType: &apos;application/xml&apos;
      }
    )
    assert(ceFullOtherContentTypeStrict !== null)
    t.ok(ceFullOtherContentTypeStrict)
    t.ok(ceFullOtherContentTypeStrict.isValid())
    t.throws(function () {
      const ceFullOtherContentTypeStrictSerialized = ceFullOtherContentTypeStrict.serialize()
      assert(ceFullOtherContentTypeStrictSerialized === null) // never executed
    }, Error, &apos;Expected exception when serializing the current CloudEvent instance&apos;)
    t.throws(function () {
      const ceFullOtherContentTypeStrictSerialized = ceFullOtherContentTypeStrict.serialize({
        encoder: null,
        encodedData: null
      })
      assert(ceFullOtherContentTypeStrictSerialized === null) // never executed
    }, Error, &apos;Expected exception when serializing the current CloudEvent instance&apos;)
  }
})

// sample encoding function, to use in tests here
function encoderSample () {
  // return `&lt;data &quot;hello&quot;=&quot;world&quot; &quot;year&quot;=&quot;2018&quot; /&gt;`
  return `&lt;data encoder=&quot;sample&quot; /&gt;`
}

/** @test {CloudEvent} */
test(&apos;serialize a CloudEvent instance with a non default contentType and a right encodedData options, expect success&apos;, (t) =&gt; {
  t.plan(11)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  t.ok(CloudEvent)

  {
    // create an instance with non default contentType (other options default): expected success ...
    // when I try to serialize specifying already encoded data (encodedData options), expect success ...
    const ceFullOtherContentType = new CloudEvent(&apos;1/non-default-contentType/sample-data/no-strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      {
        ...ceCommonOptions,
        contentType: &apos;application/xml&apos;
      }
    )
    assert(ceFullOtherContentType !== null)
    t.ok(ceFullOtherContentType)
    t.ok(ceFullOtherContentType.isValid())
    // test different combinations of serialization options
    // note that if given, encoder function has priority over encoded data
    const cceFullOtherContentTypeSerialized1 = ceFullOtherContentType.serialize({
      encoder: encoderSample
    })
    t.ok(cceFullOtherContentTypeSerialized1)
    const cceFullOtherContentTypeSerialized2 = ceFullOtherContentType.serialize({
      encodedData: `&lt;data &quot;hello&quot;=&quot;world&quot; &quot;year&quot;=&quot;2018&quot; /&gt;`
    })
    t.ok(cceFullOtherContentTypeSerialized2)
    const constEncodedData = `&lt;data &quot;constant&quot;=&quot;encoded&quot; /&gt;`
    const cceFullOtherContentTypeSerialized3 = ceFullOtherContentType.serialize({
      encoder: encoderSample,
      // encodedData: undefined
      // encodedData: null
      // encodedData: `&lt;data &quot;hello&quot;=&quot;world&quot; &quot;year&quot;=&quot;2018&quot; /&gt;`
      encodedData: constEncodedData
    })
    t.ok(cceFullOtherContentTypeSerialized3)
  }

  {
    // the same with with strict mode enabled ...
    const ceFullOtherContentTypeStrict = new CloudEvent(&apos;1/non-default-contentType/sample-data/strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonData, // data
      {
        ...ceCommonOptionsStrict,
        contentType: &apos;application/xml&apos;
      }
    )
    assert(ceFullOtherContentTypeStrict !== null)
    t.ok(ceFullOtherContentTypeStrict)
    t.ok(ceFullOtherContentTypeStrict.isValid())
    // test different combinations of serialization options
    // note that if given, encoder function has priority over encoded data
    const ceFullOtherContentTypeStrictSerialized1 = ceFullOtherContentTypeStrict.serialize({
      encoder: encoderSample
    })
    t.ok(ceFullOtherContentTypeStrictSerialized1)
    const ceFullOtherContentTypeStrictSerialized2 = ceFullOtherContentTypeStrict.serialize({
      encodedData: `&lt;data &quot;hello&quot;=&quot;world&quot; &quot;year&quot;=&quot;2018&quot; /&gt;`
    })
    t.ok(ceFullOtherContentTypeStrictSerialized2)
    const constEncodedData = `&lt;data &quot;constant&quot;=&quot;encoded&quot; /&gt;`
    const ceFullOtherContentTypeStrictSerialized3 = ceFullOtherContentTypeStrict.serialize({
      encoder: encoderSample,
      // encodedData: undefined
      // encodedData: null
      // encodedData: `&lt;data &quot;hello&quot;=&quot;world&quot; &quot;year&quot;=&quot;2018&quot; /&gt;`
      encodedData: constEncodedData
    })
    t.ok(ceFullOtherContentTypeStrictSerialized3)
  }
})

/** @test {CloudEvent} */
test(&apos;ensure the JSON Schema for a CloudEvent (static and for a normal instance) is available&apos;, (t) =&gt; {
  t.plan(6)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  t.ok(CloudEvent)

  // get JSON Schema from a static method
  const jsonSchemaStatic = CloudEvent.getJSONSchema()
  assert(jsonSchemaStatic !== null)
  t.ok(jsonSchemaStatic)
  t.strictEqual(typeof jsonSchemaStatic, &apos;object&apos;)

  // create a sample CloudEvent instance ...
  const ceFullStrict = new CloudEvent(&apos;1/full/sample-data/strict&apos;,
    &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
    &apos;/test&apos;,
    ceCommonData, // data
    ceCommonOptionsStrict
  )
  assert(ceFullStrict !== null)
  t.ok(ceFullStrict)
  // get JSON Schema from that instance
  const jsonSchema = ceFullStrict.schema
  assert(jsonSchema !== null)
  t.ok(jsonSchema)
  t.strictEqual(typeof jsonSchema, &apos;object&apos;)
})

/** create some common data with nested attributes, for better reuse in tests */
const ceCommonNestedData = { ...ceCommonData,
  nested1: {
    level1attribute: &apos;level1attributeValue&apos;,
    nested2: {
      level2attribute: &apos;level2attributeValue&apos;,
      nested3: {
        level3attribute: &apos;level3attributeValue&apos;
      }
    }
  }
}

/** @test {CloudEvent} */
test(&apos;serialize some CloudEvent instances to JSON with nested data, and ensure they are right&apos;, (t) =&gt; {
  t.plan(48)

  const CloudEvent = require(&apos;../src/&apos;) // reference the library
  // t.ok(CloudEvent)

  {
    const ceFull = new CloudEvent(&apos;1/full/sample-data-nested/no-strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonNestedData, // data
      ceCommonOptions
    )
    assert(ceFull !== null)
    t.ok(ceFull)
    t.ok(ceFull.isValid())
    t.ok(ceFull.validate().length === 0)
    t.ok(ceFull.validate({ strict: false }).length === 0)
    t.ok(ceFull.validate({ strict: true }).length === 0)
    t.ok(CloudEvent.isValidEvent(ceFull))
    t.ok(CloudEvent.validateEvent(ceFull).length === 0)
    t.ok(CloudEvent.validateEvent(ceFull, { strict: false }).length === 0)
    t.ok(CloudEvent.validateEvent(ceFull, { strict: true }).length === 0)

    const ceFullSerializedStatic = CloudEvent.serializeEvent(ceFull)
    t.ok(ceFullSerializedStatic)
    const ceFullSerialized = ceFull.serialize()
    t.ok(ceFullSerialized)
    assert(ceFullSerializedStatic === ceFullSerialized)
    t.strictSame(ceFullSerializedStatic, ceFullSerialized)
    const ceSerialize = CloudEvent.serializeEvent
    assert(ceSerialize !== null)
    t.ok(ceSerialize)
    const ceFullSerializedFunction = ceSerialize(ceFull)
    t.ok(ceFullSerializedFunction)
    t.strictSame(ceFullSerializedFunction, ceFullSerializedStatic)
    t.strictSame(ceFullSerializedFunction, ceFullSerialized)

    const ceFullSerializedComparison = `{&quot;eventID&quot;:&quot;1/full/sample-data-nested/no-strict&quot;,&quot;eventType&quot;:&quot;com.github.smartiniOnGitHub.cloudeventjs.testevent&quot;,&quot;source&quot;:&quot;/test&quot;,&quot;data&quot;:{&quot;hello&quot;:&quot;world&quot;,&quot;year&quot;:2018,&quot;nested1&quot;:{&quot;level1attribute&quot;:&quot;level1attributeValue&quot;,&quot;nested2&quot;:{&quot;level2attribute&quot;:&quot;level2attributeValue&quot;,&quot;nested3&quot;:{&quot;level3attribute&quot;:&quot;level3attributeValue&quot;}}}},&quot;cloudEventsVersion&quot;:&quot;0.1&quot;,&quot;contentType&quot;:&quot;application/json&quot;,&quot;eventTime&quot;:&quot;${commonEventTime.toISOString()}&quot;,&quot;eventTypeVersion&quot;:&quot;1.0.0&quot;,&quot;extensions&quot;:{&quot;exampleExtension&quot;:&quot;value&quot;},&quot;schemaURL&quot;:&quot;http://my-schema.localhost.localdomain&quot;}`
    t.strictSame(ceFullSerialized, ceFullSerializedComparison)
    const ceFullDeserialized = JSON.parse(ceFullSerialized) // note that some fields (like dates) will be different when deserialized in this way ...
    ceFullDeserialized.eventTime = commonEventTime // quick fix for the Date/timestamo attribute in the deserialized object
    t.same(ceFull, ceFullDeserialized)

    // ensure payload data is a copy of event data
    let dataShallowClone = ceFull.payload
    // then ensure they are different object (references) ...
    assert(dataShallowClone !== null)
    assert(dataShallowClone !== ceFull.data) // they must be different object references
    assert(dataShallowClone !== ceFull.payload) // they must be different object references, at any invocation
    t.notEqual(dataShallowClone, ceFull.data)
    t.notStrictEqual(dataShallowClone, ceFull.data)
    t.notEqual(dataShallowClone, ceFull.payload)
    dataShallowClone = &apos;changed: true&apos; // reassign to test that data won&apos;t be affected by that change
    t.notEqual(dataShallowClone, ceFull.data)
    t.strictNotSame(dataShallowClone, ceFull.data)
    t.notEqual(dataShallowClone, ceFull.payload)
  }

  {
    // the same with with strict mode enabled ...
    const ceFullStrict = new CloudEvent(&apos;1/full/sample-data-nested/strict&apos;,
      &apos;com.github.smartiniOnGitHub.cloudeventjs.testevent&apos;,
      &apos;/test&apos;,
      ceCommonNestedData, // data
      ceCommonOptionsStrict
    )
    assert(ceFullStrict !== null)
    t.ok(ceFullStrict)
    t.ok(ceFullStrict.isValid())
    t.ok(ceFullStrict.validate().length === 0)
    t.ok(ceFullStrict.validate({ strict: true }).length === 0)
    t.ok(ceFullStrict.validate({ strict: false }).length === 0)
    t.ok(CloudEvent.isValidEvent(ceFullStrict))
    t.ok(CloudEvent.validateEvent(ceFullStrict).length === 0)
    t.ok(CloudEvent.validateEvent(ceFullStrict, { strict: true }).length === 0)
    t.ok(CloudEvent.validateEvent(ceFullStrict, { strict: false }).length === 0)

    const ceFullStrictSerializedStatic = CloudEvent.serializeEvent(ceFullStrict)
    t.ok(ceFullStrictSerializedStatic)
    const ceFullStrictSerialized = ceFullStrict.serialize()
    t.ok(ceFullStrictSerialized)
    assert(ceFullStrictSerializedStatic === ceFullStrictSerialized)
    t.strictSame(ceFullStrictSerializedStatic, ceFullStrictSerialized)
    const ceSerialize = CloudEvent.serializeEvent
    assert(ceSerialize !== null)
    t.ok(ceSerialize)
    const ceFullStrictSerializedFunction = ceSerialize(ceFullStrict)
    t.ok(ceFullStrictSerializedFunction)
    t.strictSame(ceFullStrictSerializedFunction, ceFullStrictSerializedStatic)
    t.strictSame(ceFullStrictSerializedFunction, ceFullStrictSerialized)

    const ceFullStrictSerializedComparison = `{&quot;eventID&quot;:&quot;1/full/sample-data-nested/strict&quot;,&quot;eventType&quot;:&quot;com.github.smartiniOnGitHub.cloudeventjs.testevent&quot;,&quot;source&quot;:&quot;/test&quot;,&quot;data&quot;:{&quot;hello&quot;:&quot;world&quot;,&quot;year&quot;:2018,&quot;nested1&quot;:{&quot;level1attribute&quot;:&quot;level1attributeValue&quot;,&quot;nested2&quot;:{&quot;level2attribute&quot;:&quot;level2attributeValue&quot;,&quot;nested3&quot;:{&quot;level3attribute&quot;:&quot;level3attributeValue&quot;}}}},&quot;cloudEventsVersion&quot;:&quot;0.1&quot;,&quot;contentType&quot;:&quot;application/json&quot;,&quot;eventTime&quot;:&quot;${commonEventTime.toISOString()}&quot;,&quot;eventTypeVersion&quot;:&quot;1.0.0&quot;,&quot;extensions&quot;:{&quot;exampleExtension&quot;:&quot;value&quot;,&quot;strict&quot;:true},&quot;schemaURL&quot;:&quot;http://my-schema.localhost.localdomain&quot;}`
    t.strictSame(ceFullStrictSerialized, ceFullStrictSerializedComparison)
    const ceFullStrictDeserialized = JSON.parse(ceFullStrictSerialized) // note that some fields (like dates) will be different when deserialized in this way ...
    ceFullStrictDeserialized.eventTime = commonEventTime // quick fix for the Date/timestamo attribute in the deserialized object
    t.same(ceFullStrict, ceFullStrictDeserialized)

    // ensure payload data is a copy of event data
    let dataShallowCloneStrict = ceFullStrict.payload
    // then ensure they are different object (references) ...
    assert(dataShallowCloneStrict !== null)
    assert(dataShallowCloneStrict !== ceFullStrict.data) // they must be different object references
    assert(dataShallowCloneStrict !== ceFullStrict.payload) // they must be different object references, at any invocation
    t.notEqual(dataShallowCloneStrict, ceFullStrict.data)
    t.notStrictEqual(dataShallowCloneStrict, ceFullStrict.data)
    t.notEqual(dataShallowCloneStrict, ceFullStrict.payload)
    dataShallowCloneStrict = &apos;changed: true&apos; // reassign to test that data won&apos;t be affected by that change
    t.notEqual(dataShallowCloneStrict, ceFullStrict.data)
    t.strictNotSame(dataShallowCloneStrict, ceFullStrict.data)
    t.notEqual(dataShallowCloneStrict, ceFullStrict.payload)
  }
})
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
